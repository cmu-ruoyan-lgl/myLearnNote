千锋defi教程

### 区块链共识机制

POW: proof of work 工作量证明 比特币的挖矿机制是POW，以太坊的挖矿机制是POS(2022年改的之前是pow)。
POS: proof of stake 权益证明 在POS中，参与者的权益（即拥有的加密货币数量）决定了他们被选中创建新区块的概率。
POA: proof of authority 权力证明 在POA中，网络的验证者（也称为“权威节点”）是由特定的权威机构或实体预先选定的。
POC: proof of capacity 也被称为Proof of Space（PoSpace）容量证明 在POC中，参与者的硬件存储容量决定了他们被选中创建新区块的概率。
CPOC: consensus proof of capacity 也被称为Consensus Proof of Space（CPOSpace）共识容量证明 在CPOC中，参与者的硬件存储容量决定了他们被选中创建新区块的概率。

### web3密码学基础

crypto: Crypto最广泛的理解是指加密货币，比如比特币（Bitcoin）、以太坊（Ethereum）等。这些数字货币基于密码学原理构建，通过分布式账本技术（如区块链）实现去中心化、安全的交易。

柯尔霍夫原则（Kerckhoffs's Principle）：即使密码系统的任何细节除了密钥之外都对敌人公开，系统仍应保持安全。

并不一定数学上一定无法破解，只要现实中无法破解。

#### 1. 对称加密算法

优点：效率较高。
缺点：双方必须事先共享密钥，且密钥必须保密。

##### 1.1. 古代对称加密算法

```
凯撒密码：将明文中的每个字母按照字母表向后（或向前）移动固定位数来实现加密，是一种单表替换密码。
当偏移量为3时，"hello world"经过凯撒密码加密后变成 "khoor zruog"。而同样使用偏移量3，该密文可以被正确解密回 "hello world"。

[维吉尼亚](https://zhuanlan.zhihu.com/p/552942664?utm_id=0 "悬停显示")：维吉尼亚密码使用了一个关键词生成一个密钥序列，而不是固定偏移量。
```

##### 1.2. 现代替换密码

```
分组密码：DES、3DES、AES等。
流密码：PRG（伪随机数生成器）、RC4、RC5、RC6、ChaCha20等。
```

单表替换密码（Simple Substitution Cipher）是一种古老的加密方法，它基于将明文中的每一个字母替换成另一个字母或符号。这种加密方式建立了一个一对一的映射关系，即将整个字母表中的每个字母与一个特定的字母或字符进行替换。

多表替换密码（Polyalphabetic Substitution Cipher）是一种比单表替换密码更为复杂的加密方法，它不是简单地使用一个固定的替换规则，而是使用多个不同的替换表进行加密。这样可以增加密码的复杂性和安全性，因为相同的明文字母在不同位置可能被不同的密文字母代替。

分组密码：将明文按照固定的长度分组，然后对每个分组进行加密。

流密码：将明文字符逐个或以小的固定块进行加密，加密方式类似于分组密码，但没有固定的分组长度。

##### 2. 非对称加密算法

加解密：公钥加密，私钥解密。
传统方式：通过非对称交换密钥，然后再用对称加密通信
安全性来源基于某种数学难题：
    RSA：基于大整数分解的困难，N = p * q，已知N求p、q，N由两个非常大的质数p和q，p和q的位数都大于1024位，因此计算N的因式分解非常困难。
    离散对数：方程y = g^x mod p，已知y、p、g求x，g和p的位数都大于1024位，因此计算x的值非常困难。

优点：安全性更高，不需要共享密钥。
缺点：效率较低。

椭圆曲线ECC:
    y^2 + axy + by = x^3 + cx^2 + dx + e
    比特币选用的曲线是secp256k1

#### 加解密：
    A给B发信息，A用B的公钥加密，B用自己的私钥解密。

#### 数字签名
    A想证明某个消息是自己发的。
    A用自己的私钥签名，其他人用A的公钥验证签名有效性。
    在没有私钥的情况下，无法伪造签名。
    ECDSA：ECC + DSA（Digital Signature Algorithm）椭圆曲线数字签名算法

#### 区块链中的密码学

钱包
- 每个钱包地址都是实际上是一对公私钥对
- 私钥 -> 公钥 -> 乱七八糟的转化 -> 钱包地址
- 私钥是证明拥有账户的唯一方式

交易
- 每个交易是一条message
- 用你的身份发出一笔交易，即签名（不要签名未知\不可信的交易，可能导致财产损失）

Merkle Tree（默克尔树）
- 通过哈希计算，将多个数据块（区块）组合成一棵树，树的每个节点都是数据块的哈希值，树的根节点是整个树的哈希值。
- 一种依靠哈希来快速确定一个值是否在一个集合中的数据结构
- 常用于区块存储交易，发行白名单确认等场景

### 以太坊和layer2

layer2要继承layer1的安全性，扩展区块链的性能，包括交易速度、可扩展性、隐私性等。Layer 2协议通过将部分计算或存储任务从主链上移至链下，从而减轻主链的负载，提高整体性能。
常见的Layer 2技术包括状态通道（State Channels）、侧链（Sidechains）、Plasma、Optimistic Rollups、ZK-Rollups等。

ps：侧链有争议性，很多侧链的去中心化程度很弱，侧链的验证者比以太坊少很多，容易出现资产安全问题。

#### Rollup

##### Optimistic Rollups 乐观Rollups

- 假设所有交易默认都是有效的，除非有人提出挑战。这意味着当一批交易被打包成一个批次时，默认会被快速确认，并在一段时间内（通常为一周左右）对交易数据进行有效性验证。
- 如果在挑战期内没有人能够提供证据证明这些交易中存在欺诈，则该批次的交易就会被最终确定在Layer 1 上。

1. Optimistim:
   - 乐观的认为Rollup发送到以太坊主网的数据是正确的
   - 引入的争议时间延迟机制（Dispute Time Delay即DTD）
   - 使用挑战期保证数据正确性
   - 加入保证金，被挑战成功后奖励给挑战者
   - 挑战者也要支付保证金，这是为了防止DDOS攻击
   - 被挑战的交易要在主链上进行验证
   - 将最开始错误数据后面的交易进行回滚，对欺诈者惩罚
   - Advantage：技术成熟，容易实现
   - Disadvantage：
    - 挑战期过长，用户体验差
    - 要求社区内有足够多的挑战者来验证Rollup的区块的合法性并能在挑战结束前及时提交欺诈证明

2. ARBITRUM
   - 将尽可能多的工作放到链下进行，降低链上争议处理成本
   - 采用Layer2多轮交互欺诈式证明和Layer1的一步式证明
   - 验证人和挑战者通过不断二分验证来验证交易批次的正确性，从而减少挑战期的长度。
   - Advantage：ARBITRUM可支持复杂的智能合约，不受以太坊限制
   - Disadvantage：由于增加了交互次数，相对于单轮交互的证明，窗口争议期更长了，在此期间需要原始提款人在线配合。


##### ZK-Rollups 零知识Rollups

- 使用零知识证明（Zero-Knowledge Proofs）来即时验证打包的交易批次的有效性。
- 零知识证明允许证明者向验证者证明某个声明的真实性，而无需透露任何关于声明实际内容的信息。
- ZK-Rollups的安全性依赖于密码学原理，它的一个优点是不需要挑战期，可以直接在Layer 1 上获得快速且安全的确认。
- 目前ZK-Rollups通用计算能力较差。

零知识证明：零知识证明是指一方（证明者）向另一方（验证者）证明一个陈述是正确的，而无需透露除该陈述是正确之外的其他信息。
- 证明者（prover）：负责计算交易并把这些交易聚合成零知识证明。证明者是去信任话的，系统不必相信证明者是值得信任的或者说证明者所运行的硬件是值得信任的（因为数学上无法伪造假的零知识证明）。
- 验证者（validator）：验证证明者提交的零知识证明的有效性。
- 零知识证明的数学基础是：同态加密（Homomorphic Encryption）。

1. ZK-SNARK：Zero-Knowledge Succinct Non-interactive ARgument of Knowledge
- 非交互性：证明者向验证者一次性发送一个消息，两者无需进行交互。
- 简洁性：验证速度快，存储空间小
- 需要进行信任设置，要求初始化时随机产生一组所有成员共有的公共参数，初始化用到的随机源必须要销毁，如果泄漏，安全体系会崩溃，有恶意的攻击者可以制造出假的证明。
  
在区块链上的应用（下面两个不是layer2）：
- Zcash
- Filecoin

### EIP（Ethereum Improvement Proposals）

### ERC（Ethereum Request for Comments）
- 代币标准合约（ERC20）
- NFT非同质化代币（ERC721、ERC1155）
- 半同质化代币（ERC3475、ERC3525）